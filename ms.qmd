---
title: "Effects of prenatal CORT and temperature on the response to a stressor"
docx: 
bibliography: "./bib/refs.bib"
csl: "./bib/animal-behaviour.csl"
reference-doc: "./bib/tmpl.docx"
execute:
  echo: false
  error: false
  cache: false
  warning: false
link-citations: true
crossref:  
  fig-title: Fig.    # (default is "Figure")
  title-delim: —     # (default is ":")
  fig-prefix: Fig.   # (default is "Figure")
  tbl-prefix: Table  # (default is "Table")
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: setup
pacman::p_load(tidyverse, flextable, emmeans, DHARMa, brms, here, ggplot2, lme4, zoo, lmerTest, broom, tidybayes, ggh4x, cowplot, fitdistrplus, MASS, goftest, forcats, nortest, fitdistrplus, ggh4x, PupillometryR, png, grid, remotes, ggthemes, bayestestR, HDInterval, DiagrammeR, magick)
```

```{r, cleandata}
#| label: cleandata
# Obtain the main df using "./R/1_data_process.R"
source(here("R", "data_process.R"))
```

```{r, sampleSize}
#| label: sampleSize
# List with the sample sizes from the main database.
source(here("R", "func.R"))
#
species <- c("delicata", "guichenoti")
trt <- c("Control-Cold", "CORT-Cold", "Control-Hot", "CORT-Hot")
#
# Loop over species
for (s in species) {
  n_list <- list() 
  
  data_n <- mass_clean %>% 
    filter(species == s)

  for (k in trt) {
    list_name <- paste0(k)
    group_data <- data_n %>% filter(trt == k)
    n_list[[list_name]] <- nrow(group_data)
    }
  assign(paste0("n_list_", s), n_list)
}
```

```{r, countclutches}
#| label: countclutches
# Count the number of clutches per species
#
clutches_deli <- mass_clean %>% 
  filter(species == "delicata") %>%
  distinct(clutch) %>% 
  nrow()
#
clutches_guich <- mass_clean %>% 
  filter(species == "guichenoti") %>%
  distinct(clutch) %>% 
  nrow()
```


## Introduction

Animals facing stressors/disruptors and examples.  
Mechanisms involved in the response to stressors/disruptors: endocrinology.
Consequences of stressors/disruptors on animals: short-term and long-term.   

Predation as a stressor/disruptor.     

Can early environment influence the response to stressors/disruptors: physiological AND behavioural effects of GC exposure. Effects on antipredatory behaviour.     

Can early environment influence the response to stressors/disruptors: other aspects. Why is temperature important? How is related to antipredatory behaviour?  



Hypothesis PRESENTATION:   

Both temperature and CORT influence the development of proactive-reactive personality types, associated at the same time with different HPA axis reactivity. In this sense, both increases in prenatal CORT and lower temperatures are related to more reactive individuals [**REFs**], which are more sensitive to stressors. As such, I predict individuals incubated at low temperature and/or treated with CORT to be more reactive, and thus to spent more time frozen after chasing them and not coming out from the shelter. At the same time I expect these individuals to have increased phisiological costs (mass lost) when submitted to a 'chronic' stressor.


## Methods

### Subjects

We used two species of skinks, the delicate skink (_Lampropholis delicata_) and the common garden skink (_L. guichenoti_). These are oviparous, generalist, small (∼35-55 mm snout-vent length (SVL)) lizards that are sympatric in suburban areas throughout south-eastern Australia [@chapple_know_2011; @chapple_biology_2014]. However, _L. delicata_ has been reported as a successful invader in New Zealand and Hawaii, while there are not such reports for _L. guichenoti_ [@chapple_know_2011; @chapple_biology_2014]. Invassivenes does not seem to be related to differences in cognitive abilities [@bezzina2014does; @recio2025early; @recio2025early], but seems to be associated with differences in personality [**REFpers**], which may be linked to differences in their stress response [@koolhaas1999coping].      

### Subjects treatments, collection, and housing

*Breeding colony* - Lizards came from a breeding colony established in the laboratory since 2019. This colony consisted of 270 adults of _L. delicata_ and 180 adults of _L. guichenoti_ housed in plastic containers (41.5 L x 30.5 W x 21 H cm) with two males and four females per enclosure. Enclosures were provided with shelter, nonstick matting, and several small water dishes. The lizards were given water daily and were fed approx. 40 mid-size crickets (_Acheta domestica_) per enclosure three days a week. The crickets were dusted with calcium weekly and multivitamin and calcium biweekly. Room temperature was set to 22-24 ºC, but we also provided the enclosures with a heat chord and a heat lamp following a 12 h light:12 h dark cycle keeping warm side of enclosures at 34 ºC.

*Eggs collection and incubation* - Eggs were collected between mid-October 2022 to the end of February 2023. We placed a small box (12.5 L x 8.3 W x 5 H cm) with moist vermiculite in one side of the communal enclosures to provide females with a place to lay the eggs. These boxes were checked three days a week. After egg collection, we measured length and width with a digital caliper to the nearest 0.1 mm and weighted the eggs with a (OHAUS, Model spx123) digital scale with an accuracy of ± 0.001 g error. Then eggs were treated with CORT or vehicle (see CORT and temperature manipulation below) and were placed in individual cups (80 mL) with moist vermiculite (12 parts water to 4 parts vermiculite). The cups were covered with cling wrap to retain moisture and left in two incubators at two different temperatures (see CORT and temperature manipulation below) until hatching.

*Hatchlings* - Incubators were checked three times a week for hatchlings. Lizards were measured and weighed immediately after hatching. Snout-vent length (SVL) and tail length (TL) were measured to the nearest millimeter, and weight was recorded using a (OHAUS, Model spx123) digital scale with an accuracy of ± 0.001 g. Hatchlings were then placed in individual enclosures (18.7L x 13.2W x 6.3H cm) with nonstick matting and a small water dish.  All care otherwise follows similar protocols to adults (see above).  
 
#### CORT and Temperature manipulation

To test the interactive effects of CORT and incubation temperature, we manipulated CORT concentrations in eggs and incubated them at cold (23 ± 3 ºC) or hot (28 ± 3 ºC) conditions (see @fig-Methods A). We used a partial split clutch design where eggs from a given clutch were distributed equally across the four treatments when clutch sizes were larger than four and randomly across treatments when less than four. Eggs were topically supplied with either 5 µL of crystalline corticosterone (Sigma, Cat. No. C2505) dissolved in 100% ethanol at a final 10 pg CORT/mL concentration (CORT treatment), or an equal volume of 100% Ethanol (Control treatment). We selected doses based on our previous study where CORT treatment increased mean yolk CORT levels by approximately 2 standard deviations above the mean natural concentration [@crino2024eggs]. Mean incubation temperatures represent the lower and upper limits of the natural range of nest temperatures in _L. delicata_ [mean nesting temperatures = 27.4 ºC; @cheetham2011embryonic]. Nonetheless, the higher temperature treatment (28 ºC) was above the thermal optima estimated for _L. delicata_ [T~opt~ = 25 ºC; @pettersen2023maternal] and reached more stressful temperatures daily as fluctuations occurred (i.e., 31 ºC).    

#### Response to acute and long-term stressors     

Three weeks before the start of the behavioural tests, we adapted the lizard enclosures to the experimental setup. The enclosures used for the stress response trials were the same as those where the lizards had previously been housed, but modified to include only a single shelter (9 × 6 × 1.5 cm) placed at one end and a water dish in the centre. All other shelter materials and the matting substrate were removed to allow continuous monitoring. The enclosures were then relocated to the experimental rooms, each containing six racks equipped with their own CCTV system (model DVR-HP210475). The number of lizards per treatment was counterbalanced across racks to control for potential effects of room or rack position. In these three weeks, lizards were fed one calcium- and multivitamin-dusted cricket per day, and water was provided _ad libitum_. A temperature gradient was maintained using heat cords and heat lamps on a 12:12 h light–dark cycle, with room temperatures kept between 22–24 °C.          

To test the effects of prenatal conditions on the response to a stressor, we simulated a predatory attack once daily over multiple days [**insert relevant reference here**]. Each trial began with one of the researchers (PR) removing the water dish from the enclosure, followed by the shelter. The lizard was then chased for 60 seconds using a soft paintbrush, simulating a predatory attack. Immediately after the chase, the shelter — but not the water dish — was returned to its original position, marking the start of the behavioural observation period. The lizard’s behaviour was then recorded for one hour. All videos were later analysed by **MATHEO**, who was blinded to the lizards’ treatment. From each video, we recorded three behavioural variables: i) latency to move — the time spent immobile (frozen) immediately after the simulated attack; ii) latency to shelter — the time it took the lizard to hide under the shelter after resuming movement; and iii) emergence — whether the lizard emerged from the shelter during the 40 minutes following hiding (1 = emerged, 0 = did not emerge). A lizard was considered to have resumed movement if it moved continuously for at least five seconds, and to be under shelter if no limbs were visible. This procedure was repeated daily for eight consecutive days to assess the effects of mid-term exposure to a stressor. All trials were conducted between 1000–1400 h, when lizards are most active.       

Both before and after the completion of the behavioural tests, lizard mass was measured to the nearest 0.001 g using a digital scale. Change in mass was calculated as the difference between final minus the initial mass and then rescaled by adding the smallest mass change observed in the dataset, to avoid negative values. This rescaled change in mass was used as a proxy for the physiological cost of repeated stress exposure. To control for hunger levels and potential effects of food ingestion on mass change, we also recorded the number of crickets ingested by each lizard during the acclimation period. To do so, we placed a known number of crickets in each enclosure after each of the trials, and counted the number of crickets remaining after 24 hours. The total number of crickets ingested during the eight days of tests was then used as a covariate in the analyses of mass change. The experimental design is summarised in @fig-Methods B.          
  
```{r, fig-Methods}
#| label: fig-Methods
#| fig.cap: "Scheme of our experimental design. In panel A, the early environment manipulations resulting in four experimental conditions. In panel B, the timeline of the postnatal stress-response assay. On Day 0, lizard mass was recorded. From Days 1–8, lizards were subjected daily to a simulated predator attack (chased with a soft paintbrush for 1 minute), followed by a 1-hour behavioural recording. Variables measured included freezing duration (latency to move), latency to shelter, and emergence from shelter. Final mass was measured on Day 9."

knitr::include_graphics("./Others/Methods.png")

```

### Statistical analyses

We performed the analyses for each species separately. We fitted all models using the _brm_ package [@burkner2017brms], which fits Bayesian multilevel models with _Stan_ [@stan] with R version 4.4.0 [@R]. We ran four parallel MCMC chains of 10000 iterations for each model, with a warmup period of 4000 iterations. 

We used as the response variables the latency to move, latency to shelter, and emergence from the shelter after the simulated attack, as well as the change in mass after the eight days of stress exposure. We fitted separate models for each response variable. For the three behavioural variables, we included the prenatal condition (Control-Cold, CORT-Cold, Control-Hot, CORT-Hot), the day of the trial, and their interaction as fixed effects. To facilitate interpretation of the model intercepts, trial day was transformed so that day 1 in the experiment corresponds to day 0 in the model (i.e. the intercept reflects lizard behaviour in response to the first exposure to the stressor). For the variable mass, we included the prenatal condition, the total number of crickets ingested during the eight days of stress exposure, and their interaction as predictors.

Lizard identity was included as a random factor in the behavioural models, but it was not included when mass was the response. For all models, we included the clutch as a random factor. _L. delicata_ lays one clutch per year, while _L. guichenoti_ lays two [@chapple_know_2011; @chapple2015deliinvLHI]. Since eggs were collected during half of the breeding season, clutches likely come from different mothers. Additionally, previous research has shown that clutches are generally sired by a single male, but sperm storage can occur [@kar2023heritability]. Given our partial split-clutch design, and the fact that maternal effects are expected to be stronger than paternal effects in these species, including the clutch as a random factor should account for the effects of parental identity.   
 
We used the posterior distributions of model parameters to test for differences between prenatal conditions. For behavioural variables, differences in the model intercepts between conditions were interpreted as differences in the acute response to a stressor (i.e. the first day of exposure), while differences in the slopes were interpreted as differences in behavioural adjustment across repeated exposures (i.e. chronic stress response). Similarly, for mass change, we interpreted differences in the condition-by-ingestion interaction (i.e. variation in the slopes of mass change across treatment groups) as reflecting differences in energy assimilation efficiency with increased food intake. _pMCMC_ was used to test the hypothesis that posterior distributions of slopes and slope contrasts differed from zero. We considered an effect statistically significant when _pMCMC_ <0.05.       


## Results

We started with 96 lizards, 48 per species and 12 per treatment per species. However, our final sample size was 84 due to natural mortality (n = 10). The final sample sizes per treatment and species are listed in @fig-results_beh_deli, @fig-results_beh_guich and @fig-results_mass. These animals came from a total of `r clutches_deli` clutches in _L. delicata_ and `r clutches_guich` in _L. guichenoti_.      

```{r, models_behaviour}
#| label: models_behaviour
source(here("R", "func.R"))
#
refit <- FALSE
#
# A) L. delicata
deli_beh <- behav_clean %>% 
  filter(species == "delicata") %>%
  mutate(lat_move = lat_move + 1, 
         lat_shelter = lat_shelter + 1)
#
deli_move <- fit_m(df = deli_beh, fam = lognormal(), type = "beh", sp = "deli", var = "lat_move")
deli_shelter <- fit_m(df = deli_beh, fam = lognormal(), type = "beh", sp = "deli", var = "lat_shelter")
deli_emergence <- fit_m(df = deli_beh, fam = bernoulli(link = "logit"), type = "beh", sp = "deli", var = "emergence")
#
#
# B) L. guichenoti
guich_beh <- behav_clean %>%
  filter(species == "guichenoti") %>%
  mutate(lat_move = lat_move + 1, 
         lat_shelter = lat_shelter + 1)
#
guich_move <- fit_m(df = guich_beh, fam = lognormal(), type = "beh", sp = "guich", var = "lat_move")
guich_shelter <- fit_m(df = guich_beh, fam = lognormal(), type = "beh", sp = "guich", var = "lat_shelter")
guich_emergence <- fit_m(df = guich_beh, fam = bernoulli(link = "logit"), type = "beh", sp = "guich", var = "emergence")
```

```{r, models_mass}
#| label: models_mass
source(here("R", "func.R"))
#
refit <- FALSE
#
# A) L. delicata
deli_mass <- mass_clean %>%
  filter(species == "delicata")
#
deli_mass <- fit_m(df = deli_mass, fam = lognormal(), type = "mass", sp = "deli", var = "delta_mass_rescaled")
# 
#
# B) L. guichenoti
guich_mass <- mass_clean %>%
  filter(species == "guichenoti")
#
guich_mass <- fit_m(df = guich_mass, fam = lognormal(), type = "mass", sp = "guich", var = "delta_mass_rescaled")
```

```{r, post_contrasts}
#| label: post_contrasts
#  
source(here("R", "func.R"))
#
# Getting the values for each treatments' intercept and slope for the contrasts later
## A) L. delicata
deli_move_posteriors <- post_values(deli_move, var = "beh")
deli_shelter_posteriors <- post_values(deli_shelter, var = "beh")
deli_emergence_posteriors <- post_values(deli_emergence, var = "beh")
deli_mass_posteriors <- post_values(deli_mass, var = "mass")
#
## B) L. guichenoti
guich_move_posteriors <- post_values(guich_move, var = "beh")
guich_shelter_posteriors <- post_values(guich_shelter, var = "beh")
guich_emergence_posteriors <- post_values(guich_emergence, var = "beh")
guich_mass_posteriors <- post_values(guich_mass, var = "mass")
#
#
# Getting the contrasts for the posterior distributions
## A) L. delicata
deli_move_contrasts <- contrasts_func(sp = "deli", res = "move")
deli_shelter_contrasts <- contrasts_func(sp = "deli", res = "shelter")
deli_emergence_contrasts <- contrasts_func(sp = "deli", res = "emergence")
deli_mass_contrasts <- contrasts_func(sp = "deli", res = "mass")
#
## B) L. guichenoti
guich_move_contrasts <- contrasts_func(sp = "guich", res = "move")
guich_shelter_contrasts <- contrasts_func(sp = "guich", res = "shelter")
guich_emergence_contrasts <- contrasts_func(sp = "guich", res = "emergence")
guich_mass_contrasts <- contrasts_func(sp = "guich", res = "mass")
```


#### Do prenatal conditions affect the behavioural response to an acute stressor?

_Lampropholis delicata_: Incubation at cold temperatures decreased the latency to move after a simulated attack on the first day (Intercept (denoted hereafter as I)~Hot~ - I ~Cold~ = `r deli_move_contrasts$mean_Temperature_int`; pMCMC `r deli_move_contrasts$pMCMC_Temperature_int`), while neither CORT or the interaction have any effect on latency to shelter or emergence (see @fig-results_beh_deli and Table S1 in _Supplementary Material_). We did not find any effects of prenatal temperature, CORT or their interaction on latency to shelter or emergence probability after an acute stressor (see @fig-results_beh_deli and Table S1 in _Supplementary Material_).    


_Lampropholis guichenoti_: Neither prenatal CORT, temperature, nor their interaction had any effect on the behavioural response to an acute stressor on _L. guichenoti_ (see @fig-results_beh_guich and Table S2 in _Supplementary Material_).        


```{r, fig-results_beh_deli}
#| label: fig-results_beh_deli
#| fig.cap: "Behavioural response of Lampropholis delicata to an stressor." 

#### Panels A and D show the predicted probability of choosing the correct ramp in the first trial (Decision first trial). In panels B and E, the distribution of the estimates of slopes per each treatment. In all A, B, D, and E the x-axis represents the slope estimate, and in the y-axis are the density of the estimates. The different colors indicate the different treatments. Points and bars represent the mean and standard deviation of the mean of the estimates, respectively. Dashed lines indicate value 0.33 (the probability of choosing correctly by chance) in panels A, D, and 0 in panels B, E. Asterisks indicate significant results (p~mcmc~ < 0.05). Panels C and F show the predicted probability of choosing the correct ramp first over trials. The lines represent the mean predicted probability of choosing the correct ramp for each trial, and the shaded areas indicate the standard deviation of the mean; both were obtained using the slope and intercept estimates from the posterior distributions. The different colors indicate the different treatments.
source(here("R", "func.R"))
# First step, create the dfs for all variables
## ACUTE STRESSORS
deli_move_acute <- plotting(sp = "deli", res = "move", type = "int") 
deli_move_chronic <- plotting(sp = "deli", res = "move", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
deli_move_trials <- plotting(sp = "deli", res = "move", type = "trials")
#
deli_shelter_acute <- plotting(sp = "deli", res = "shelter", type = "int")
deli_shelter_chronic <- plotting(sp = "deli", res = "shelter", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
deli_shelter_trials <- plotting(sp = "deli", res = "shelter", type = "trials")
#
deli_emergence_acute <- plotting(sp = "deli", res = "emergence", type = "int")
deli_emergence_chronic <- plotting(sp = "deli", res = "emergence", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
deli_emergence_trials <- plotting(sp = "deli", res = "emergence", type = "trials")
#
# Getting the legend
legend_plot <- plotting(sp = "deli", res = "move", type = "int") + 
  theme(legend.position = "bottom", legend.title = element_blank())
gtable <- ggplotGrob(legend_plot)
legend <- gtable$grobs[[which(sapply(gtable$grobs, function(x) x$name) == "guide-box")]]
#
# Merge the plots
deli_beh <- plot_grid(deli_move_acute, deli_move_chronic, deli_move_trials,
                      deli_shelter_acute, deli_shelter_chronic, deli_shelter_trials,
                      deli_emergence_acute, deli_emergence_chronic, deli_emergence_trials,
                      ncol = 3, nrow = 3,
                      rel_widths = c(0.75, 0.75, 1))
#
fig_deli_beh <- ggdraw() +
  # Make background white
  theme(plot.background = element_rect(fill = "white", color = NA)) +
  # Insert legend 
  draw_grob(legend, x = 0.49, y = 0.015, width = 0.01, height = 0.01) +
  # Add the final plot but with reduced size for the legend and "title"
  draw_plot(deli_beh, x = 0, y = 0.04, width = 1, height = 0.91) +
  # Insert title for each plot
  annotate("text", x = 0.02, y = 0.948, label = "A", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.948, label = "B", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.948, label = "C", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.02, y = 0.645, label = "D", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.645, label = "E", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.645, label = "F", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.02, y = 0.341, label = "G", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.341, label = "H", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.341, label = "I", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  # Insert name species
  annotate("text", x = 0.58, y = 0.99, label = "Lampropholis delicata", hjust = 1, vjust = 1, size = 6, fontface = "italic")
#
ggsave("./output/figures/main/fig_deli_beh.png", plot=fig_deli_beh, width = 21, height = 25, units = "cm", dpi = 600)
knitr::include_graphics("./output/figures/main/fig_deli_beh.png")
```


#### Do prenatal conditions affect the behavioural response to a chronic stressor?

_Lampropholis delicata_: **HOW WERE THE SLOPES OVER TIME??**. We did not find any effects of prenatal conditions in _L. delicata_ response to a chronic stressor, as there were no significant differences in the slopes of the different treatments for any of the behavioural variables (see Table S1 in _Supplementary Material_).


_Lampropholis guichenoti_: **HOW WERE THE SLOPES OVER TIME??**. There were no significant differences in the behavioural response of _L. guichenoti_ to the repeated exposure to an stressor (see Table S2 in _Supplementary Material_).

```{r, fig-results_beh_guich}
#| label: fig-results_beh_guich
#| fig.cap: "Behavioural response of Lampropholis guichenoti to an stressor." 
#
source(here("R", "func.R"))
# First step, create the dfs for all variables
## ACUTE STRESSORS
guich_move_acute <- plotting(sp = "guich", res = "move", type = "int") 
guich_move_chronic <- plotting(sp = "guich", res = "move", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
guich_move_trials <- plotting(sp = "guich", res = "move", type = "trials")
#
guich_shelter_acute <- plotting(sp = "guich", res = "shelter", type = "int")
guich_shelter_chronic <- plotting(sp = "guich", res = "shelter", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
guich_shelter_trials <- plotting(sp = "guich", res = "shelter", type = "trials")
#
guich_emergence_acute <- plotting(sp = "guich", res = "emergence", type = "int")
guich_emergence_chronic <- plotting(sp = "guich", res = "emergence", type = "slop") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black")
guich_emergence_trials <- plotting(sp = "guich", res = "emergence", type = "trials")
#
# Getting the legend
legend_plot <- plotting(sp = "guich", res = "move", type = "int") + 
  theme(legend.position = "bottom", legend.title = element_blank())
gtable <- ggplotGrob(legend_plot)
legend <- gtable$grobs[[which(sapply(gtable$grobs, function(x) x$name) == "guide-box")]]
#
# Merge the plots
guich_beh <- plot_grid(guich_move_acute, guich_move_chronic, guich_move_trials,
                      guich_shelter_acute, guich_shelter_chronic, guich_shelter_trials,
                      guich_emergence_acute, guich_emergence_chronic, guich_emergence_trials,
                      ncol = 3, nrow = 3,
                      rel_widths = c(0.75, 0.75, 1))
#
fig_guich_beh <- ggdraw() +
  # Make background white
  theme(plot.background = element_rect(fill = "white", color = NA)) +
  # Insert legend 
  draw_grob(legend, x = 0.49, y = 0.015, width = 0.01, height = 0.01) +
  # Add the final plot but with reduced size for the legend and "title"
  draw_plot(guich_beh, x = 0, y = 0.04, width = 1, height = 0.91) +
  # Insert title for each plot
  annotate("text", x = 0.02, y = 0.948, label = "A", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.948, label = "B", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.948, label = "C", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.02, y = 0.645, label = "D", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.645, label = "E", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.645, label = "F", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.02, y = 0.341, label = "G", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.318, y = 0.341, label = "H", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.615, y = 0.341, label = "I", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  # Insert name species
  annotate("text", x = 0.58, y = 0.99, label = "Lampropholis guichenoti", hjust = 1, vjust = 1, size = 6, fontface = "italic")
#
ggsave("./output/figures/main/fig_guich_beh.png", plot=fig_guich_beh, width = 21, height = 25, units = "cm", dpi = 600)
knitr::include_graphics("./output/figures/main/fig_guich_beh.png")
```

#### Do prenatal conditions influence the costs of repeated stress exposure?

_Lampropholis delicata_:


_Lampropholis guichenoti_:



```{r, fig-results_mass}
#| label: fig-results_mass
#| fig.cap: "Change in mass of Lampropholis delicata and Lampropholis guichenoti after eight days of repeated stress exposure." 
#
#
source(here("R", "func.R"))
#
## L delicata
deli_mass_plot <- plotting(sp = "deli", res = "mass", type = "int") +
  theme(legend.position = "none",
        legend.title = element_blank())
# Getting the legend
legend_plot_deli <- plotting(sp = "deli", res = "mass", type = "int") + 
  theme(legend.position = "right", legend.title = element_blank())
gtable_deli <- ggplotGrob(legend_plot_deli)
legend_deli <- gtable_deli$grobs[[which(sapply(gtable_deli$grobs, function(x) x$name) == "guide-box")]]
#
## L guichenoti
guich_mass_plot <- plotting(sp = "guich", res = "mass", type = "int") +
  theme(legend.position = "none",
        legend.title = element_blank())
# Getting the legend
legend_plot_guich <- plotting(sp = "guich", res = "mass", type = "int") + 
  theme(legend.position = "right", legend.title = element_blank())
gtable_guich <- ggplotGrob(legend_plot_guich)
legend_guich <- gtable_guich$grobs[[which(sapply(gtable_guich$grobs, function(x) x$name) == "guide-box")]]
#
mass_grid <- plot_grid(deli_mass_plot, NULL, guich_mass_plot, NULL,
                       ncol = 4, nrow = 1,
                       rel_widths = c(0.5, 0.5, 0.5, 0.45))
#
fig_mass <- ggdraw() +
  # Make background white
  theme(plot.background = element_rect(fill = "white", color = NA)) +
  # Add the final plot but with reduced size for the legend and "title"
  draw_plot(mass_grid, x = 0, y = 0, width = 1, height = 0.92) +
  # Insert species name
  annotate("text", x = 0.36, y = 0.99, label = "Lampropholis delicata", hjust = 1, vjust = 1, size = 5, fontface = "italic") +
  annotate("text", x = 0.9, y = 0.99, label = "Lampropholis guichenoti", hjust = 1, vjust = 1, size = 5, fontface = "italic") +
  # Insert title for each plot
  annotate("text", x = 0.023, y = 0.91, label = "A", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  annotate("text", x = 0.535, y = 0.91, label = "B", hjust = 1, vjust = 1, size = 6, fontface = "bold") +
  # Insert picture species
  draw_image(here("./Others/Deli.png"), x = 0.271, y = 0.65, width = 0.22, height = 0.22) +
  draw_image(here("./Others/Guich.png"), x = 0.78, y = 0.65, width = 0.22, height = 0.22) +
  # Insert legends
  draw_grob(legend_deli, x = 0.375, y = 0.275, width = 0.01, height = 0.01) +
  draw_grob(legend_guich, x = 0.88, y = 0.275, width = 0.01, height = 0.01)
#
ggsave("./output/figures/main/fig_mass.png", plot=fig_mass, width = 21, height = 8, units = "cm", dpi = 600)
knitr::include_graphics("./output/figures/main/fig_mass.png")
```

#### Do both species differ in their behavioural response to an stressor?   

- Acute stressor: differences between intercepts (put everything together or compare between incubation conditions?)   

- Chronic stressor: differences between slopes   


## Discussion


## References

## Supplementary material

_Table S1. Contrasts of the posterior distributions of the predictors for each behavioural variable modelled for L. delicata. The contrasts are between the intercepts and slopes of the different treatments. Lower and upper CI, and pMCMC values test the hypothesis that the estimate is different from 0. In bold, the values that are significant at pMCMC < 0.05._     

```{r, table_contrasts_deli}
#| label: table_contrasts_deli
#
source(here("R", "func.R"))
# 
# Get the posterior contrasts for L. delicata and merge them into a single df
contrast_deli_beh <- bind_rows(move = deli_move_contrasts,
                              shelter = deli_shelter_contrasts,
                              emergence = deli_emergence_contrasts,
                              .id = "variable") %>%
                    mutate(across(everything(), as.character)) %>%
 
                    pivot_longer(cols = -variable,
                                names_to = c("type", "factor", "stat"),
                                names_pattern = "(mean|pMCMC)_(.*)_(int|slope)") %>%
 
                    pivot_wider(names_from = c(type, stat),
                                values_from = value) %>%
data.frame()
write.csv(contrast_deli_beh, here("./output/checking/contrasts_deli_beh.csv"))
#
#
# Set defaults for the table
set_flextable_defaults(
  font.family = "Times New Roman",
  font.size = 10)
#
# Make Table
table_deli_behaviour <- flextable(contrast_deli_beh) %>%
  flextable::compose(i = 1, j = 1, value = as_paragraph("Variable"), part = "header") %>% # Change the first column header
  flextable::compose(i = 1, j = 2, value = as_paragraph("Predictor"), part = "header") %>% # Change the second column header
  flextable::compose(i = 1, j = c(3,5), value = as_paragraph("Contrast"), part = "header") %>% # Change the third column header
  flextable::compose(i = 1, j = c(4,6), value = as_paragraph("pMCMC"), part = "header") %>% # Change the fourth column header
  flextable::add_header_row(values = c("", "Acute (Intercept)", "Chronic (Slope)"), colwidths = c(2, 2, 2)) %>% # Add a header row
  flextable::compose(i = c(2,3,5,6,8,9), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
  flextable::compose(i = 1, j = 1, value = as_paragraph("Latency to move"), part = "body") %>% # Change the first row of the first column
  flextable::compose(i = 4, j = 1, value = as_paragraph("Latency to shelter"), part = "body") %>% # Change the fourth row of the first column
  flextable::compose(i = 7, j = 1, value = as_paragraph("Emergence"), part = "body") %>% # Change the seventh row of the first column
  flextable::hline(i = c(3,6), part = "body") %>% # Add horizontal lines
  flextable::vline(j = c(2,4), part = "all") %>% # Add vertical lines
  align(align = "center", j = c(3:6), part = "body") %>%
  align(align = "center", i = c(1,2), j = c(1:6), part = "header") %>%
  flextable::bold(i = 1, j = c(3,4), bold = TRUE, part = "body") %>% 
autofit()
#
table_deli_behaviour
```

Contrasts were done by:  
    - _Temperature_: β~Hot~ - β~Cold~  
    - _CORT_: β~CORT~ - β~Control~  
    - _Interaction_: (β~Control-Hot~ - β~CORT-Hot~) - (β~Control-Cold~ - β~CORT-Cold~)  


```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

_Table S2. Contrasts of the posterior distributions of the predictors for each behavioural variable modelled for L. guichenoti. The contrasts are between the intercepts and slopes of the different treatments. Lower and upper CI, and pMCMC values test the hypothesis that the estimate is different from 0. In bold, the values that are significant at pMCMC < 0.05._    

```{r, table_contrasts_guich}
#| label: table_contrasts_guich
#
source(here("R", "func.R"))
# Get the posterior contrasts for L. guichenoti and merge them into a single df
contrast_guich_beh <- bind_rows(move = guich_move_contrasts,
                              shelter = guich_shelter_contrasts,
                              emergence = guich_emergence_contrasts,
                              .id = "variable") %>%
                    mutate(across(-variable, as.character)) %>%
 
                    pivot_longer(cols = -variable,
                                names_to = c("type", "factor", "stat"),
                                names_pattern = "(mean|pMCMC)_(.*)_(int|slope)") %>%
 
                    pivot_wider(names_from = c(type, stat),
                                values_from = value) %>%
data.frame()
write.csv(contrast_guich_beh, here("./output/checking/contrasts_guich_beh.csv"))
#
#
# Set defaults for the table
set_flextable_defaults(
  font.family = "Times New Roman",
  font.size = 10)
#
# Make Table
table_guich_behaviour <- flextable(contrast_guich_beh) %>%
  flextable::compose(i = 1, j = 1, value = as_paragraph("Variable"), part = "header") %>% # Change the first column header
  flextable::compose(i = 1, j = 2, value = as_paragraph("Predictor"), part = "header") %>% # Change the second column header
  flextable::compose(i = 1, j = c(3,5), value = as_paragraph("Contrast"), part = "header") %>% # Change the third column header
  flextable::compose(i = 1, j = c(4,6), value = as_paragraph("pMCMC"), part = "header") %>% # Change the fourth column header
  flextable::add_header_row(values = c("", "Acute (Intercept)", "Chronic (Slope)"), colwidths = c(2, 2, 2)) %>% # Add a header row
  flextable::compose(i = c(2,3,5,6,8,9), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
  flextable::compose(i = 1, j = 1, value = as_paragraph("Latency to move"), part = "body") %>% # Change the first row of the first column
  flextable::compose(i = 4, j = 1, value = as_paragraph("Latency to shelter"), part = "body") %>% # Change the fourth row of the first column
  flextable::compose(i = 7, j = 1, value = as_paragraph("Emergence"), part = "body") %>% # Change the seventh row of the first column
  flextable::hline(i = c(3,6), part = "body") %>% # Add horizontal lines
  flextable::vline(j = c(2,4), part = "all") %>% # Add vertical lines
  align(align = "center", j = c(3:6), part = "body") %>%
  align(align = "center", i = c(1,2), j = c(1:6), part = "header") %>% 
autofit()
#
table_guich_behaviour
```

Contrasts were done by:  
    - _Temperature_: β~Hot~ - β~Cold~  
    - _CORT_: β~CORT~ - β~Control~  
    - _Interaction_: (β~Control-Hot~ - β~CORT-Hot~) - (β~Control-Cold~ - β~CORT-Cold~)  



```{r, results='asis', echo=FALSE}
cat("\\newpage") 
```

_Table S3. Values of the slopes for the different treatments for each behavioural variable modelled for both species. The values are the posterior means and 95% credible intervals (CI). In bold, the values that are different from 0, tested by pMCMC < 0.05._

**INSERT TABLE FOR SLOPES**


```{r, results='asis', echo=FALSE}
cat("\\newpage") 
```

_Table S4. Contrasts for mass modelled for both species. The contrasts are between the slopes of the different treatments. Lower and upper CI, and pMCMC values test the hypothesis that the estimate is different from 0. In bold, the values that are significant at pMCMC < 0.05._

**INSERT TABLE FOR MASS**


```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

```{r, clean_posteriors_tables}
#| label: clean_posteriors_tables
source(here("R", "func.R"))
#
variables <- c("move", "shelter", "emergence", "mass")
species <- c("deli", "guich")
# Initialize empty lists
posterior_list <- list(deli = list(), guich = list())
# Loop over species and variables
for(i in species){
  for(j in variables){
    model_object <- get(paste0(i, "_", j))
    result <- tidy_post(df = model_object)
    posterior_list[[i]][[j]] <- result
  }
}
#
deli_post <- dplyr::bind_rows(posterior_list$deli, .id = "variable")
guich_post <- dplyr::bind_rows(posterior_list$guich, .id = "variable")
```

_Table S5. Estimates of each predictor for each variable modelled for L. delicata.  Lower and upper CI, and pMCMC values test the hypothesis that the estimate is different from 0. In bold, the values that are significant at pMCMC < 0.05._

```{r, tablesummary_deli}
#| label: tablesummary_deli
#
# Table defaults
set_flextable_defaults(
 font.family = "Times New Roman",
 font.size = 10)
# Make Table
table_summ_deli <- flextable(deli_post) %>%
  flextable::compose(i = 1, j = 1, value = as_paragraph("Variable"), part = "header") %>% # Change the first column header
  align(align = "center", j = c(3:6), part = "body") %>%
  align(align = "center", j = c(1:6), part = "header") %>%
  bold(~`pMCMC` < 0.05, j = c("pMCMC", "CI_upper", "CI_lower", "Mean", "Predictor"),
       bold = TRUE) %>%  # Bold when PMCMC is "<0.05"
  bold(~`pMCMC` <0.001, j = c("pMCMC", "CI_upper", "CI_lower", "Mean", "Predictor")) %>%  # Bold when PMCMC is "<0.001"
  flextable::compose(i = c(2:8,10:16,18:24,26:29), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
  flextable::hline(i = c(8,16,24), part = "body") %>% # Add horizontal lines
  autofit()
#
table_summ_deli
```

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

_Table S6. Estimates of each predictor for each variable modelled for L. delicata.  Lower and upper CI, and pMCMC values test the hypothesis that the estimate is different from 0. In bold, the values that are significant at pMCMC < 0.05._

```{r, tablesummary_guich}
#| label: tablesummary_guich
#
# Table defaults
set_flextable_defaults(
 font.family = "Times New Roman",
 font.size = 10)
# Make Table
table_summ_guich <- flextable(guich_post) %>%
  flextable::compose(i = 1, j = 1, value = as_paragraph("Variable"), part = "header") %>% # Change the first column header
  align(align = "center", j = c(3:6), part = "body") %>%
  align(align = "center", j = c(1:6), part = "header") %>% 
  bold(~`pMCMC` < 0.05, j = c("pMCMC", "CI_upper", "CI_lower", "Mean", "Predictor"),
       bold = TRUE) %>%  # Bold when PMCMC is "<0.05"
  bold(~`pMCMC` <0.001, j = c("pMCMC", "CI_upper", "CI_lower", "Mean", "Predictor")) %>%  # Bold when PMCMC is "<0.001"
  flextable::compose(i = c(2:8,10:16,18:24,26:29), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
  flextable::hline(i = c(8,16,24), part = "body") %>% # Add horizontal lines
  autofit()
#
table_summ_guich
```

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```


